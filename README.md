## Требования

* Python 3.7+

## Установка окружения

### Создание виртуального окружения

Рекомендуется использовать виртуальное окружение Python для изоляции зависимостей проекта:

#### Windows

```bash
# Создание виртуального окружения
python -m venv venv

# Активация виртуального окружения
venv\Scripts\activate
```

#### macOS / Linux

```bash
# Создание виртуального окружения
python3 -m venv venv

# Активация виртуального окружения
source venv/bin/activate
```

После активации виртуального окружения в начале строки терминала должен появиться префикс `(venv)`.

## Установка

1. Клонируйте репозиторий или скачайте файлы
2. Переходим в папку при помощи cd ПУТЬ_ДО_ПАПКИ
3. Установите необходимые зависимости:

```bash
pip install -r requirements.txt
```

## Запуск

Запустите скрипт с помощью команды:

```bash
python parse.py
```

При первом запуске будут созданы файлы конфигурации `search_config.json` и `telethon_settings.json` с параметрами по умолчанию.

## Настройка поиска

Параметры поиска можно изменить в файле `search_config.json`:

```json
{
    "desc_query": "Список поисковых запросов для поиска каналов (обрабатываются последовательно)",
    "query": ["Crypto", "Finance", "Blockchain"],
    
    "desc_start_offset": "Начальное смещение для пагинации (с какой позиции начинать поиск)",
    "start_offset": 0,
    
    "desc_subscribers_min": "Минимальное количество подписчиков для фильтрации",
    "subscribers_min": 1000,
    
    "desc_subscribers_max": "Максимальное количество подписчиков для фильтрации",
    "subscribers_max": 10000000,
    
    "desc_is_verified": "Фильтр по верифицированным каналам (true - только верифицированные)",
    "is_verified": false,
    
    "desc_categories": "Фильтр по категориям каналов (пустая строка - все категории)",
    "categories": "",
    
    "desc_countries": "Фильтр по странам (пустая строка - все страны)",
    "countries": "",
    
    "desc_languages": "Фильтр по языкам (пустая строка - все языки)",
    "languages": ""
}
```

## Проверка комментариев в Telegram-каналах

### Настройка API Telegram

Для проверки наличия открытых комментариев в Telegram-каналах используется библиотека Telethon. Чтобы эта функция работала, необходимо:

1. Получить `api_id` и `api_hash` на сайте [my.telegram.org/apps](https://my.telegram.org/apps)
2. Указать эти данные в файле `telethon_settings.json`:

```json
{
    "api_id": 123456,  // Ваш API ID (целое число)
    "api_hash": "abcdef1234567890abcdef1234567890",  // Ваш API Hash (строка)
    "session_name": "tg_session",  // Имя файла сессии
    "check_comments": true,  // Включить проверку комментариев
    "skip_channels_without_comments": true,  // Пропускать каналы без комментариев
    "connection_retries": 5,  // Количество попыток подключения
    "request_delay": 1.5  // Задержка между запросами в секундах
}
```

При первом использовании Telethon потребуется авторизация. Следуйте инструкциям в консоли для входа в аккаунт Telegram.

### Как это работает

Когда `check_comments` установлен в `true`, парсер:
1. Собирает каналы согласно параметрам поиска из `search_config.json`
2. Проверяет каждый канал на наличие открытых комментариев с помощью Telethon API
3. Если `skip_channels_without_comments` установлен в `true`, пропускает каналы без открытых комментариев
4. Сохраняет результаты с информацией о наличии комментариев

## Примеры использования

### Поиск криптовалютных каналов

Измените параметр `query` в конфигурационном файле:

```json
"query": ["Crypto", "Bitcoin", "Ethereum"]
```

### Поиск каналов с большим количеством подписчиков

```json
"subscribers_min": 100000
```

### Поиск только каналов с открытыми комментариями

В файле `telethon_settings.json` установите:

```json
"check_comments": true,
"skip_channels_without_comments": true
```

## Результаты

Результаты сохраняются в директории `./output` в двух форматах:

1. `channels_YYYYMMDD_HHMMSS.json` - полная информация о каналах в формате JSON, включая данные о наличии комментариев
2. `usernames_YYYYMMDD_HHMMSS.txt` - список юзернеймов каналов в формате `@username [комментарии: да/нет]`

Для каждого запуска создаются новые файлы с уникальными именами, включающими дату и время запуска. 